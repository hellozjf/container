<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>集装箱可视化</title>
    <!--<link rel="stylesheet" href="css/bootstrap.css">-->
    <!--<link rel="stylesheet" href="css/bootstrap-theme.css">-->
    <!--<script src="js/jquery-3.1.1.js"></script>-->
    <!--<script src="js/bootstrap.js"></script>-->
    <!--<script src="js/china.js"></script>-->
    <!--<script src="js/highcharts.src.js"></script>-->
    <!--<script src="js/highcharts-3d.src.js"></script>-->
    <!--<script src="js/data.src.js"></script>-->
    <!--<script src="js/drilldown.src.js"></script>-->
    <!--<script src="js/exporting.src.js"></script>-->
    <!--<script src="js/map.src.js"></script>-->
    <!--<script src="js/cn-china.js"></script>-->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="http://cdn.hcharts.cn/highcharts/highcharts.js"></script>
    <script src="http://cdn.hcharts.cn/highcharts/highcharts-3d.js"></script>
    <script src="http://cdn.hcharts.cn/highmaps/modules/map.js"></script>
    <script src="http://cdn.hcharts.cn/highmaps/modules/data.js"></script>
    <script src="http://cdn.hcharts.cn/highmaps/modules/drilldown.js"></script>
    <script src="http://cdn.hcharts.cn/highmaps/modules/exporting.js"></script>
    <script src="http://sandbox.runjs.cn/uploads/rs/228/zroo4bdf/cn-china-by-peng8.js"></script>
</head>
<body>
<div class="container-fluid">

    <!-- Static navbar -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                        aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">集装箱可视化</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#tab1" data-toggle="tab" onclick="showChart1();">从业人员总量监测</a></li>
                    <li><a href="#tab2" data-toggle="tab" onclick="showChart2();">从业人员流动率</a></li>
                    <li><a href="#tab3" data-toggle="tab" onclick="showChart3();">平均作业天数</a></li>
                    <li><a href="#tab4" data-toggle="tab" onclick="showChart4();">作业人员籍贯分布</a></li>
                    <li><a href="#tab5" data-toggle="tab" onclick="showChart5();">累计作业人员占比</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
    </nav>

    <div class="tab-content" id="tabs">

        <!-- 从业人员总量检测 -->
        <div class="tab-pane active" id="tab1">
            <div class="col-md-9" id="chart1" style="height:600px;"></div>
            <div class="col-md-3">
                <form role="form">
                    <div class="form-group">
                        <label for="tab1-select-year">选择年份</label>
                        <select id="tab1-select-year">
                            <option>2015</option>
                            <option selected="selected">2016</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tab1-select-month">选择月份</label>
                        <select id="tab1-select-month">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                            <option>11</option>
                            <option>12</option>
                        </select>
                    </div>
                    <button id="btnChart1" type="button" class="btn btn-default" onclick="showChart1()">查看</button>
                </form>
            </div>
        </div>

        <!-- 从业人员流动率 -->
        <div class="tab-pane" id="tab2">
            <div class="col-md-9" id="chart2" style="height:600px;"></div>
            <div class="col-md-3">
                <form role="form">
                    <div class="form-group">
                        <label for="tab2-select-year">选择年份</label>
                        <select id="tab2-select-year">
                            <option>2015</option>
                            <option selected="selected">2016</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tab2-select-month">选择月份</label>
                        <select id="tab2-select-month">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                            <option>11</option>
                            <option>12</option>
                        </select>
                    </div>
                    <button id="btnChart2" type="button" class="btn btn-default" onclick="showChart2()">查看</button>
                </form>
            </div>
        </div>

        <!-- 平均作业天数 -->
        <div class="tab-pane" id="tab3">
            <div class="col-md-9" id="chart3" style="height:600px;"></div>
            <div class="col-md-3">
                <form role="form">
                    <div class="form-group">
                        <label for="tab3-select-year">选择年份</label>
                        <select id="tab3-select-year">
                            <option>2015</option>
                            <option selected="selected">2016</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tab3-select-month">选择月份</label>
                        <select id="tab3-select-month">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                            <option>11</option>
                            <option>12</option>
                        </select>
                    </div>
                    <button id="btnChart3" type="button" class="btn btn-default" onclick="showChart3()">查看</button>
                </form>
            </div>
        </div>

        <!-- 作业人员籍贯分布 -->
        <div class="tab-pane" id="tab4">
            <div class="col-md-9" id="chart4" style="height:600px;"></div>
            <div class="col-md-3">
                <form role="form">
                    <div class="form-group">
                        <label class="checkbox-inline">
                            <input type="radio" name="radioMethodOptions" id="radioMethodMap" value="map"
                                   onclick="showChart4();" checked> 地图展示
                        </label>
                    </div>
                    <div>
                        <label class="checkbox-inline">
                            <input type="radio" name="radioMethodOptions" id="radioMethodPie" value="pie"
                                   onclick="showChart4();"> 饼图展示
                        </label>
                    </div>
                </form>
            </div>
        </div>

        <!-- 累积作业人员占比 -->
        <div class="tab-pane" id="tab5">
            <div class="col-md-9" id="chart5" style="height:600px;"></div>
            <div class="col-md-3">
                <form role="form">
                    <div class="form-group">
                        <label for="tab5-select-year">选择年份</label>
                        <select id="tab5-select-year">
                            <option>2015</option>
                            <option selected="selected">2016</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tab5-select-month">选择月份</label>
                        <select id="tab5-select-month">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                            <option>11</option>
                            <option>12</option>
                        </select>
                    </div>
                    <button id="btnChart5" type="button" class="btn btn-default" onclick="showChart5()">查看</button>
                </form>
            </div>
        </div>
    </div>

</div> <!-- /container -->

<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<script type="text/javascript">

    // 自定义的函数
    function showChart1() {
        var year = parseInt($('#tab1-select-year').val());
        var month = parseInt($('#tab1-select-month').val());
        var xAxisData = [];
        var seriesData = [];
        for (var i = year - 1; i <= year; i++) {
            if (i == year - 1) {
                for (var j = month + 1; j <= 12; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    //seriesData.push(Math.random() * 100);
                }
            } else {
                for (var j = 1; j <= month; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    //seriesData.push(Math.random() * 100);
                }
            }
        }

        $.ajax({
            type: "POST",
            url: "NumPersonServlet",
            data: {
                year:year,
                month:month
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                seriesData = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        $('#chart1').highcharts({
            chart: {
                type: 'line',
            },
            title: {
                text: '从业人员总量监测'
            },
            subtitle: {
                text: year + '年' + month + '月'
            },
            xAxis: {
                categories: xAxisData
            },
            yAxis: {
                title: {
                    text: '人数'
                }
            },
            series: [{
                name: '从业人员总量',
                data: seriesData
            }]
        });
    }

    function showChart2() {
        var year = parseInt($('#tab2-select-year').val());
        var month = parseInt($('#tab2-select-month').val());
        var xAxisData = [];
        var seriesData = [];
        for (var i = year - 1; i <= year; i++) {
            if (i == year - 1) {
                for (var j = month + 1; j <= 12; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    <!--seriesData.push(Math.random());-->
                }
            } else {
                for (var j = 1; j <= month; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    <!--seriesData.push(Math.random());-->
                }
            }
        }

        var totalNum = [];
        // 获取12个月总人数
        $.ajax({
            type: "POST",
            url: "NumPersonServlet",
            data: {
                year:year,
                month:month
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                totalNum = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        var changeNum = [];
        // 获取12个月变动的人数
        $.ajax({
            type: "POST",
            url: "NumOfChangeServlet",
            data: {
                year:year,
                month:month
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                changeNum = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        for (var i = 0; i < 12; i++) {
            seriesData[i] = (totalNum[i] == 0 ? 0 : parseFloat(changeNum[i]) / totalNum[i]);
        }

        $('#chart2').highcharts({
            chart: {
                type: 'line'
            },
            title: {
                text: '从业人员流动率'
            },
            subtitle: {
                text: year + '年' + month + '月'
            },
            xAxis: {
                categories: xAxisData
            },
            yAxis: {
                title: {
                    text: '比例'
                }
            },
            series: [{
                name: '从业人员流动率',
                data: seriesData
            }]
        });
    }

    function showChart3() {
        var year = parseInt($('#tab3-select-year').val());
        var month = parseInt($('#tab3-select-month').val());
        var xAxisData = [];
        var seriesData = [];
        for (var i = year - 1; i <= year; i++) {
            if (i == year - 1) {
                for (var j = month + 1; j <= 12; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    <!--seriesData.push(Math.random() * 30);-->
                }
            } else {
                for (var j = 1; j <= month; j++) {
                    xAxisData.push(i + '年' + j + '月');
                    <!--seriesData.push(Math.random() * 30);-->
                }
            }
        }

        $.ajax({
            type: "POST",
            url: "AverageWorkdayServlet",
            data: {
                year:year,
                month:month
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                seriesData = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        $('#chart3').highcharts({
            chart: {
                type: 'line'
            },
            title: {
                text: '平均作业天数'
            },
            subtitle: {
                text: year + '年' + month + '月'
            },
            xAxis: {
                categories: xAxisData
            },
            yAxis: {
                title: {
                    text: '天数'
                }
            },
            series: [{
                name: '平均作业天数',
                data: seriesData
            }]
        });
    }

    function showChart4() {

        var seriesData = [];
        $.ajax({
            type: "POST",
            url: "NativeOfPersonServlet",
            data: {
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                seriesData = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        if ($("input[name='radioMethodOptions']:checked").val() == "map") {
            var data = Highcharts.geojson(Highcharts.maps['countries/cn/custom/cn-all-china']);
//            var small = $('#chart4').width() < 400;
            $.each(data, function (i) {
                this.drilldown = this.properties['drill-key'];
                this.value = seriesData[i];
            });

            $('#chart4').highcharts('Map', {
                chart: {
                    events: {
                        drilldown: function (e) {
                            if (!e.seriesOptions) {
                                var chart = this;
                                var cname = e.point.properties["cn-name"];
                                chart.showLoading('<i class="icon-spinner icon-spin icon-3x"></i>');
                                // 加载城市数据
                                $.ajax({
                                    type: "GET",
                                    url: "http://data.hcharts.cn/jsonp.php?filename=GeoMap/json/" + e.point.drilldown + ".geo.json",
                                    contentType: "application/json; charset=utf-8",
                                    dataType: 'jsonp',
                                    crossDomain: true,
                                    success: function (json) {
                                        data = Highcharts.geojson(json);

                                        $.each(data, function (i) {

                                            // 每个市的数据
//                                            this.value = i;
//                                            this.events = {};

                                        });
                                        chart.hideLoading();

                                        chart.addSeriesAsDrilldown(e.point, {
                                            name: e.point.name,
                                            data: data,
                                            events: {
                                                show: function () {
                                                    alert(1);
                                                }
                                            },
                                            dataLabels: {
                                                enabled: true,
                                                format: '{point.name}'
                                            }
                                        });
                                    },
                                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                                    }
                                });
                            }
                            this.setTitle(null, {text: cname});
                        },
                        drillup: function () {
                            this.setTitle(null, {text: '中国'});
                        }
                    }
                },
                title: {
                    text: '作业人员籍贯分布'
                },
                subtitle: {
                    text: '中国',
                    floating: true,
                    align: 'right',
                    y: 50,
                    style: {
                        fontSize: '16px'
                    }
                },
                tooltip: {
                    formatter: function () {
                        var htm = "中国<br/>";

                        if (this.point.drilldown) {
                            htm += this.point.properties["cn-name"];
                        } else {
                            htm += this.point.name;
                        }
                        htm += ":" + this.point.value;
                        return htm;

                    }
                },
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },
                colorAxis: {
                    min: 0,
                    minColor: '#FFFFFF',
                    maxColor: '#3398DB'
                },
                mapNavigation: {
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom'
                    }
                },
                plotOptions: {
                    map: {
                        states: {
                            hover: {
                                color: '#EEDD66'
                            }
                        }
                    }
                },
                series: [{
                    data: data,
                    name: '中国',
                    dataLabels: {
                        enabled: true,
                        format: '{point.properties.cn-name}'
                    }
                }],
                drilldown: {
                    //series: drilldownSeries,
                    activeDataLabelStyle: {
                        color: '#FFFFFF',
                        textDecoration: 'none',
                        textShadow: '0 0 3px #000000'
                    },
                    drillUpButton: {
                        relativeTo: 'spacingBox',
                        position: {
                            x: 0,
                            y: 60
                        }
                    }
                }
            });
        } else {
            var provinces = ['上海','浙江','西沙群岛','澳门','台湾','甘肃','香港','宁夏','陕西','安徽','湖北','广东','福建','北京','河北','山东','天津','江苏','海南','青海','吉林','西藏','新疆','河南','内蒙古','黑龙江','云南','广西','辽宁','四川','重庆','贵州','湖南','山西','江西'];
            var data = [];
            for (var i = 0; i < provinces.length; i++) {
                var d = [];
                d.push(provinces[i]);
                d.push(seriesData[i]);
                data.push(d);
            }
            $('#chart4').highcharts({
                chart: {
                    type: 'pie',
                    options3d: {
                        enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                },
                title: {
                    text: '作业人员籍贯分布'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        depth: 35,
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}'
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Browser share',
                    data: data
                }]
            });
        }
    }

    function showChart5() {
        var year = parseInt($('#tab5-select-year').val());
        var month = parseInt($('#tab5-select-month').val());
        var xAxisData = ['1-7天', '8-14天', '15-21天', '21天以上'];
        var seriesData = [];

        $.ajax({
            type: "POST",
            url: "NumOfWorkServlet",
            data: {
            	year:year,
            	month:month
            },
            dataType:"json",
            async : false,
            success:function(returnMsg) {
                <!--console.log(returnMsg);-->
                seriesData = returnMsg;
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert(textStatus + errorThrown);
				return false;
			}
        });

        var data = [];
        for (var i = 0; i < 4; i++) {
            var d = [];
            d.push(xAxisData[i]);
            d.push(seriesData[i]);
            data.push(d);
        }

        $('#chart5').highcharts({
            chart: {
                type: 'pie',
                options3d: {
                    enabled: true,
                    alpha: 45,
                    beta: 0
                }
            },
            title: {
                text: '累计作业人员占比'
            },
            subtitle: {
                text: year + '年' + month + '月'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    depth: 35,
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}'
                    }
                }
            },
            series: [{
                type: 'pie',
                name: 'Browser share',
                data: data
            }]
        });
    }

    // 主入口函数
    $(function () {
        showChart1();
    });
</script>
</body>
</html>